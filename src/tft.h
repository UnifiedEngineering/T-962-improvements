/*
 * tft.h
 *
 *  Created on: 25 pa≈∫ 2021
 *      Author: s.bartkowicz
 */

#ifndef TFT_H_
#define TFT_H_

#include "display.h"

#ifdef USES_TFT_DISPLAY

#define TFT_CONTROLLER (ILI9486)

#define ILI9325 (0x9325)		// 2.4" 240x320 Arduino Uno display shield
#define ILI9341 (0x9341)		// 2.8" 240x320 Arduino Uno display shield
#define ILI9486 (0x9486)		// 3.5" 320x480 Arduino Uno display shield


#define TFT_RS_COMMAND	FIO0CLR = (1<< 22);
#define TFT_RS_DATA		FIO0SET = (1<< 22);
#define TFT_WR_LOW		FIO0CLR = (1<< 19);
#define TFT_WR_HIGH		FIO0SET = (1<< 19);
#define TFT_RD_LOW		FIO0CLR = (1<< 18);
#define TFT_RD_HIGH		FIO0SET = (1<< 18);
#define TFT_CS_LOW		FIO0CLR	= (1<< 13);
#define TFT_CS_HIGH		FIO0SET = (1<< 13);
#define	TFT_RST_LOW		FIO0CLR	= (1<< 12);
#define TFT_RST_HIGH	FIO0SET = (1<< 12);
#define TFT_DATA_INPUTS	FIO1DIR &= 0xFF00FFFF;
#define TFT_DATA_OUTPUTS FIO1DIR |= 0x00FF0000;
#define TFT_DELAY { \
		FIO1PIN; }
#define TFT_WSTROBE {	\
			TFT_DELAY;	\
			TFT_WR_LOW;	\
			TFT_DELAY;	\
			TFT_WR_HIGH;}

#if TFT_CONTROLLER==ILI9486
const static int16_t TFT_init_sequence[] = {
	/* Soft Reset */
	-1, 0x01,
	-2, 1000,
	-1, 0xc0, 0x19, 0x1a,
	-1, 0xc1, 0x45, 0x00,
	-1, 0xc2, 0x33,
	-1, 0xc5, 0x00, 0x28,	//, 0x00, 0x48,
	-1, 0xb1, 0xa0, 0x11,
	-1, 0xb4, 0x02,
	-1, 0xb6, 0x00, 0x42, 0x3b,
	-1, 0xE0, 0x0F, 0x1F, 0x1C, 0x0C, 0x0F, 0x08, 0x48, 0x98, 0x37, 0x0A, 0x13, 0x04, 0x11, 0x0D, 0x00,
	-1, 0xE1, 0x0F, 0x32, 0x2E, 0x0B, 0x0D, 0x05, 0x47, 0x75, 0x37, 0x06, 0x10, 0x03, 0x24, 0x20, 0x00,
	-1, 0xE2, 0x0F, 0x32, 0x2E, 0x0B, 0x0D, 0x05, 0x47, 0x75, 0x37, 0x06, 0x10, 0x03, 0x24, 0x20, 0x00,
	-1, 0x3a, 0x55,
	-1, 0xb6, 0x00, 0x22,
	-1, 0x36, 0x68,
	-1, 0x11,
	-2, 150,
	-1, 0x29,
	-1, 0x2a, 0x00, 0x00, 0x01, 0x3f,	// define window x
	-1, 0x2b, 0x00, 0x00, 0x00, 0xf0,	// define window y
	-3
};
#elif TFT_CONTROLLER==ILI9341
const static int16_t TFT_init_sequence[] = {
		-1, 0x01,
		-2, 1000,
		-1, 0xc8, 0x39, 0x2c, 0x00, 0x34, 0x02,
		-1, 0xcf, 0x00, 0xc1, 0x30,
		-1, 0xe8, 0x85, 0x00, 0x78,
		-1, 0xea, 0x00, 0x00,
		-1, 0xed, 0x64, 0x03, 0x12, 0x81,
		-1, 0xf7, 0x20,
		-1, 0xc0, 0x23,
		-1, 0xc1, 0x10,
		-1, 0xc5, 0x28,
		-1, 0xc7, 0x86,
		-1, 0x36, 0x28,
		-1, 0x3a, 0x55,
		-1, 0xb6, 0x00, 0x82, 0x27,
		-1, 0xf2, 0x00,
		-1, 0x26, 0x01,
		-1, 0xe0, 0x0f, 0x31, 0x2b, 0x0c, 0x0e, 0x08, 0x4e, 0xf1, 0x37, 0x07, 0x10, 0x03, 0x0e, 0x09, 0x00,
		-1, 0xe1, 0x00, 0x0e, 0x14, 0x03, 0x11, 0x07, 0x31, 0xc1, 0x48, 0x08, 0x0f, 0x0c, 0x31, 0x36, 0x0f,
		-1, 0x11,
		-2, 150,
		-1, 0x29,
		-1, 0x2a, 0x00, 0x00, 0x01, 0x3f,	// define window x
		-1, 0x2b, 0x00, 0x00, 0x00, 0xf0,	// define window y
		-3
};
#else	// ILI9325
const static int16_t TFT_init_sequence[]= {
	-1, 0xe3, 0x30, 0x08,
	-1, 0xe7, 0x00, 0x12,
	-1, 0xef, 0x12, 0x31,
	-1, 0x01, 0x00, 0x00,
	-1, 0x02, 0x07, 0x00,
	-1, 0x03, 0x10, 0x38,
	-1, 0x04, 0x00, 0x00,
	-1, 0x08, 0x02, 0x02,
	-1, 0x09, 0x00, 0x00,
	-1, 0x0a, 0x00, 0x00
	-1, 0x0c, 0x00, 0x00,
	-1, 0x0d, 0x00, 0x00,
	-1, 0x0f, 0x00, 0x00,
	-1, 0x10, 0x00, 0x00,
	-1, 0x11, 0x00, 0x00,
	-1, 0x12, 0x01, 0x39,
	-1, 0x13, 0x00, 0x00,
	-2, 200,
	-1, 0x10, 0x11, 0x90,
	-1, 0x11, 0x02, 0x27,
	-2, 50,
	-1, 0x12, 0x00, 0x1c,
	-2, 50,
	-1, 0x13, 0x1d, 0x00,
	-1, 0x29, 0x00, 0x13,
	-1, 0x2b, 0x00, 0x09,
	-2, 50,

	-1, 0x30, 0x00, 0x07,
	-1, 0x31, 0x03, 0x02,
	-1, 0x32, 0x01, 0x05,
	-1, 0x35, 0x02, 0x06,
	-1, 0x36, 0x08, 0x08,
	-1, 0x37, 0x02, 0x06,
	-1, 0x38, 0x05, 0x04,
	-1, 0x39, 0x00, 0x07,
	-1, 0x3c, 0x01, 0x05,
	-1, 0x3d, 0x08, 0x08,

	-1, 0x60, 0x27, 0x00,
	-1, 0x61, 0x00, 0x05,
	-1, 0x6a, 0x00, 0x00,
	//-------------- Partial Display Control ---------//
	-1, 0x80, 0x00, 0x00,
	-1, 0x81, 0x00, 0x00,
	-1, 0x82, 0x00, 0x00,
	-1, 0x83, 0x00, 0x00,
	-1, 0x84, 0x00, 0x00,
	-1, 0x85, 0x00, 0x00,

	//-------------- Panel Control -------------------//
	-1, 0x90, 0x00, 0x10,
	-1, 0x92, 0x00, 0x00,
	-1, 0x93, 0x00, 0x03,
	-1, 0x95, 0x11, 0x00,
	-1, 0x97, 0x00, 0x00,
	-1, 0x98, 0x00, 0x00,
	-1, 0x07, 0x01, 0x33,
	-2, 150,
	//------------------ Set GRAM area ---------------//
	-1, 0x50, 0x00, 0x00,		// window x start
	-1, 0x51, 0x00, 0xef,		// window x end
	-1, 0x52, 0x00, 0x00,		// window y start
	-1, 0x53, 0x01, 0x3f,		// window y end
	-1, 0x20, 0x00, 0x00,	// gram horizontal start address
	-1, 0x21, 0x00, 0x00,	// gram vertical start address
	-3
};
#endif


uint32_t charoutbig(uint8_t theChar, uint16_t X, uint16_t Y, uint8_t theFormat);

void TFT_Init(void);
void TFT_FB_Clear(void);
void TFT_FB_Update(uint8_t* fb);
void TFT_SetPixel(uint16_t x, uint16_t y);
void TFT_DrawLine(int16_t x0, int16_t y0, int16_t x1, int16_t y1);
void TFT_DrawGrid(uint16_t x0, uint16_t y0, uint16_t x1, uint16_t y1, uint16_t xmin, uint16_t ymin, uint16_t xmax, uint16_t ymax,uint16_t density);
void TFT_SetCross(uint16_t x,uint16_t y);

#endif

#endif /* TFT_H_ */

